

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Production Environments &mdash; Galaxy Project 23.1.5.dev0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" href="../_static/style.css" type="text/css" />

  
    <link rel="canonical" href="https://docs.galaxyproject.org/en/master/admin/production.html"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=da3e81e8"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Security considerations" href="security.html" />
    <link rel="prev" title="Logging Configuration" href="config_logging.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Galaxy Project
          </a>
              <div class="version">
                23.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../releases/index.html">Releases</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../releases/23.1_announce_user.html">June 2023 Galaxy Release (v 23.1)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/23.0_announce_user.html">2023 Galaxy Release (v 23.0)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/22.05_announce_user.html">May 2022 Galaxy Release (v 22.05)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/22.01_announce_user.html">January 2022 Galaxy Release (v 22.01)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/21.09_announce_user.html">September 2021 Galaxy Release (v 21.09)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/21.05_announce_user.html">May 2021 Galaxy Release (v 21.05)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/21.01_announce_user.html">January 2021 Galaxy Release (v 21.01)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/20.09_announce_user.html">September 2020 Galaxy Release (v 20.09)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/20.05_announce_user.html">May 2020 Galaxy Release (v 20.05)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/20.01_announce_user.html">January 2020 Galaxy Release (v 20.01)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/19.09_announce_user.html">September 2019 Galaxy Release (v 19.09)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/19.05_announce_user.html">May 2019 Galaxy Release (v 19.05)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/19.01_announce_user.html">January 2019 Galaxy Release (v 19.01)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/18.09_announce.html">September 2018 Galaxy Release (v 18.09)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/18.05_announce.html">May 2018 Galaxy Release (v 18.05)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/18.01_announce.html">January 2018 Galaxy Release (v 18.01)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/17.09_announce.html">September 2017 Galaxy Release (v 17.09)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/17.05_announce.html">May 2017 Galaxy Release (v 17.05)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/17.01_announce.html">January 2017 Galaxy Release (v 17.01)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/16.10_announce.html">October 2016 Galaxy Release (v 16.10)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/16.07_announce.html">July 2016 Galaxy Release (v 16.07)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/16.04_announce.html">April 2016 Galaxy Release (v 16.04)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/16.01_announce.html">January 2016 Galaxy Release (v 16.01)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/15.10_announce.html">October 2015 Galaxy Release (v 15.10)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/15.07_announce.html">July 2015 Galaxy Release (v 15.07)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/15.05_announce.html">May 2015 Galaxy Release (v 15.05)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/15.03_announce.html">March 2015 Galaxy Release (v 15.03)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/15.01_announce.html">January 2015 Galaxy Release (v 15.01)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/14.10_announce.html">October 2014 Galaxy Release (v 14.10)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/14.08_announce.html">August 2014 Galaxy Release (v 14.08)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/14.06_announce.html">June 2014 Galaxy Release (v 14.06)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/14.04_announce.html">April 2014 Galaxy Release (v 14.04)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/14.02_announce.html">February 2014 Galaxy Release (v 14.02)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/13.11_announce.html">November 2013 Galaxy Release (v 13.11)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/13.08_announce.html">August 2013 Galaxy Release (v 13.08)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/13.06_announce.html">June 2013 Galaxy Release (v 13.06)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/13.04_announce.html">April 2013 Galaxy Release (v 13.04)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/13.02_announce.html">February 2013 Galaxy Release (v 13.02)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/13.01_announce.html">January 2013 Galaxy Release (v 13.01)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../releases/older_releases.html">Galaxy Releases older than v 13.01</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Admin Documentation</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Administration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="python.html">Supported Python versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="framework_dependencies.html">Framework Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="config.html">Galaxy Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="config_logging.html">Logging Configuration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Production Environments</a></li>
<li class="toctree-l2"><a class="reference internal" href="security.html">Security considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="nginx.html">Proxying Galaxy with NGINX</a></li>
<li class="toctree-l2"><a class="reference internal" href="apache.html">Proxying Galaxy with Apache</a></li>
<li class="toctree-l2"><a class="reference internal" href="scaling.html">Scaling and Load Balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="cluster.html">Connecting to a Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="jobs.html">Galaxy Job Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="authentication.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="tool_panel.html">Tool Panel Administration</a></li>
<li class="toctree-l2"><a class="reference internal" href="mq.html">Message queue</a></li>
<li class="toctree-l2"><a class="reference internal" href="dependency_resolvers.html">Dependency Resolvers in Galaxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="container_resolvers.html">Containers in Galaxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="container_resolvers.html#other-considerations">Other considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="conda_faq.html">Conda for Tool Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="db_migration.html">Galaxy Database Schema Migrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="reports.html">Galaxy Reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="useful_scripts.html">Scripts &amp; Tricks</a></li>
<li class="toctree-l2"><a class="reference internal" href="options.html">Configuration Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrating_to_gunicorn.html">Migrating from uWSGI to Gunicorn and FastAPI</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="special_topics/index.html">Special topics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="special_topics/ftp.html">Galaxy FTP Uploads</a></li>
<li class="toctree-l2"><a class="reference internal" href="special_topics/interactivetools.html">Galaxy InteractiveTools</a></li>
<li class="toctree-l2"><a class="reference internal" href="special_topics/mulled_containers.html">Containers for Tool Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="special_topics/grt.html">Galactic Radio Telescope</a></li>
<li class="toctree-l2"><a class="reference internal" href="special_topics/gtn.html">Galaxy Training Materials Webhook</a></li>
<li class="toctree-l2"><a class="reference internal" href="special_topics/job_metrics.html">Job Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="special_topics/webhooks.html">Galaxy Webhooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="special_topics/vault.html">Storing secrets in the vault</a></li>
<li class="toctree-l2"><a class="reference internal" href="special_topics/performance_tracking.html">Galaxy Performance Tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="special_topics/bug_reports.html">Bug Reports</a></li>
<li class="toctree-l2"><a class="reference internal" href="special_topics/gdpr_compliance.html">GDPR Compliance</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/index.html">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../dev/schema.html">Galaxy Tool XML File</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/api_guidelines.html">API Design Guidelines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/build_a_job_runner.html">Build a job runner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/finding_and_improving_slow_code.html">Finding and improving slow Galaxy code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/data_managers.html">Data managers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/data_types.html">Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/faq.html">How Do I…</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/writing_tests.html">Writing Tests for Galaxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/debugging_tests.html">Debugging Galaxy Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/debugging_tests.html#debugging-tests-that-run-out-of-memory">Debugging tests that run out of memory</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/debugging_galaxy.html">Debugging Galaxy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/debugging_galaxy_slurm.html">Debugging Galaxy: Slurm Compute Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/translating.html">Translating the Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../dev/create_point_release.html">Creating Galaxy Point Releases</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api_doc.html">Galaxy API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/quickstart.html"> Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/api.html"> Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../ts_api_doc.html">Tool Shed API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/ts_api.html"> API Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../lib/modules.html">Application Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../lib/galaxy.html">galaxy package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/galaxy_ext.html">galaxy_ext package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/galaxy_test.html">galaxy_test package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../lib/tool_shed.html">tool_shed package</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About Project</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../project/organization.html">Project Governance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../project/organization.html#procedure-documents">Procedure Documents</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/organization.html#committers">Committers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/organization.html#release-branches">Release branches</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/organization.html#handling-pull-requests">Handling Pull Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/organization.html#issue-reporting">Issue Reporting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../project/issues.html">Issue Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../project/issues.html#issue-reporting">Issue Reporting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/issues.html#milestones">Milestones</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/issues.html#labeling-structure">Labeling Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/issues.html#the-roadmap">The Roadmap</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/issues.html#voting">Voting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../project/issues.html#automation">Automation</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Galaxy Project</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Galaxy Deployment &amp; Administration</a></li>
      <li class="breadcrumb-item active">Production Environments</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/admin/production.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="production-environments">
<h1>Production Environments<a class="headerlink" href="#production-environments" title="Link to this heading">¶</a></h1>
<p>The <a class="reference external" href="https://getgalaxy.org">basic installation instructions</a> are suitable for development by a single user, but when setting up Galaxy for a multi-user production environment, there are some additional steps that should be taken for the best performance.</p>
<section id="why-bother">
<h2>Why bother?<a class="headerlink" href="#why-bother" title="Link to this heading">¶</a></h2>
<p>By default, Galaxy:</p>
<ul class="simple">
<li><p>Uses <a class="reference external" href="https://www.sqlite.org/">SQLite</a> (a serverless database), so you don’t have to run/configure a database server for quick or basic development.  However, while SQLite <a class="reference external" href="https://sqlite.org/lockingv3.html">supports concurrent access</a> it does not support multiple concurrent writes, which can reduce system throughput.</p></li>
<li><p>Uses a built-in HTTP server, written in Python.  Much of the work performed by this server can be moved to <a class="reference internal" href="nginx.html"><span class="std std-doc">nginx</span></a> or <a class="reference internal" href="apache.html"><span class="std std-doc">Apache</span></a>, which will increase performance.</p></li>
<li><p>Runs all tools locally.  Moving to a <a class="reference internal" href="cluster.html"><span class="std std-doc">cluster</span></a> will greatly increase capacity.</p></li>
<li><p>Runs in a single process, which is a performance problem in <a class="reference external" href="https://en.wikipedia.org/wiki/CPython">CPython</a>.</p></li>
</ul>
<p>Galaxy ships with this default configuration to ensure the simplest, most error-proof configuration possible when doing basic development.  As you’ll soon see, the goal is to remove as much work as possible from the Galaxy process, since doing so will greatly speed up the performance of its remaining duties.  This is due to the Python Global Interpreter Lock (GIL), which is explained in detail in the <a class="reference internal" href="#advanced-configuration">Advanced Configuration</a> section.</p>
</section>
<section id="groundwork-for-scalability">
<h2>Groundwork for scalability<a class="headerlink" href="#groundwork-for-scalability" title="Link to this heading">¶</a></h2>
<section id="use-a-clean-environment">
<h3>Use a clean environment<a class="headerlink" href="#use-a-clean-environment" title="Link to this heading">¶</a></h3>
<p>Many of the following instructions are best practices for any production application.</p>
<ul class="simple">
<li><p>Create a <strong>NON-ROOT</strong> user called galaxy.  Running as an existing user will cause problems down the line when you want to grant or restrict access to data.</p></li>
<li><p>Start with a fresh checkout of Galaxy, don’t try to convert one previously used for development.  Download and install it in the galaxy user home directory.</p></li>
<li><p>Galaxy should be a managed system service (like Apache, mail servers, database servers, <em>etc.</em>) run by the galaxy user.  Init scripts, OS X launchd definitions and Solaris SMF manifests are provided in the <code class="docutils literal notranslate"><span class="pre">contrib/</span></code> directory of the distribution.  You can also use the <code class="docutils literal notranslate"><span class="pre">--daemon</span></code> and <code class="docutils literal notranslate"><span class="pre">--stop-daemon</span></code> arguments to <code class="docutils literal notranslate"><span class="pre">run.sh</span></code> to start and stop by hand, but still run detached.  When running as a daemon the server’s output log will be written to <code class="docutils literal notranslate"><span class="pre">galaxy.log</span></code> instead of the terminal, unless instructed otherwise with the <code class="docutils literal notranslate"><span class="pre">--log-file</span></code> argument.</p></li>
<li><p>Give Galaxy its own database user and database to prevent Galaxy’s schema from conflicting with other tables in your database.  Also, restrict Galaxy’s database user so it only has access to its own database.</p></li>
<li><p>Make sure Galaxy is using a clean Python interpreter. Conflicts in <code class="docutils literal notranslate"><span class="pre">$PYTHONPATH</span></code> or the interpreter’s <code class="docutils literal notranslate"><span class="pre">site-packages/</span></code> directory could cause problems. Galaxy manages its own dependencies for the framework, so you do not need to worry about these. The easiest way to do this is with a <a class="reference external" href="https://virtualenv.pypa.io/">virtualenv</a>:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nate</span><span class="nd">@weyerbacher</span><span class="o">%</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">virtualenv</span>
<span class="n">nate</span><span class="nd">@weyerbacher</span><span class="o">%</span> <span class="n">virtualenv</span> <span class="o">--</span><span class="n">no</span><span class="o">-</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span> <span class="n">galaxy_env</span>
<span class="n">nate</span><span class="nd">@weyerbacher</span><span class="o">%</span> <span class="o">.</span> <span class="o">./</span><span class="n">galaxy_env</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">nate</span><span class="nd">@weyerbacher</span><span class="o">%</span> <span class="n">cd</span> <span class="n">galaxy</span><span class="o">-</span><span class="n">dist</span>
<span class="n">nate</span><span class="nd">@weyerbacher</span><span class="o">%</span> <span class="n">sh</span> <span class="n">run</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Galaxy can be housed in a cluster/network filesystem (it’s been tested with NFS and GPFS), and you’ll want to do this if you’ll be running it on a <a class="reference internal" href="cluster.html"><span class="std std-doc">cluster</span></a>.</p></li>
</ul>
</section>
</section>
<section id="basic-configuration">
<h2>Basic configuration<a class="headerlink" href="#basic-configuration" title="Link to this heading">¶</a></h2>
<p>The steps to install Galaxy mostly follow those of the <a class="reference external" href="https://getgalaxy.org">regular instructions</a>.  The difference is that after performing the groundwork above, you should initialize the configuration file (<code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">config/galaxy.yml.sample</span> <span class="pre">config/galaxy.yml</span></code>) and modify it as outlined below before starting the server. If you make any changes to this configuration file while the server is running, you will have to restart the server for the changes to take effect.</p>
<section id="disable-the-developer-settings">
<h3>Disable the developer settings<a class="headerlink" href="#disable-the-developer-settings" title="Link to this heading">¶</a></h3>
<p>Debugging options are set in the sample <code class="docutils literal notranslate"><span class="pre">config/galaxy.yml</span></code> which should not be enabled on a production server.  Check the following items:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">debug:</span> <span class="pre">false</span></code> - Disable middleware that loads the entire response in memory for displaying debugging information in the page.  If left enabled, the proxy server may timeout waiting for a response or your Galaxy process may run out of memory if it’s serving large files.</p></li>
<li><p>Disable <code class="docutils literal notranslate"><span class="pre">filter-with:</span> <span class="pre">gzip</span></code>.  Leaving the gzip filter enabled will cause UI failures because of the way templates are streamed once <code class="docutils literal notranslate"><span class="pre">debug</span></code> is set to <code class="docutils literal notranslate"><span class="pre">False</span></code>.  You will still be able (and are encouraged) to enable gzip in the proxy server.</p></li>
</ul>
<p>During deployment, you may run into problems with failed jobs.  By default, Galaxy removes files related to job execution. You can instruct Galaxy to keep files of failed jobs with: <code class="docutils literal notranslate"><span class="pre">cleanup_job:</span> <span class="pre">onsuccess</span></code></p>
</section>
<section id="switching-to-postgresql-database-server">
<h3>Switching to PostgreSQL database server<a class="headerlink" href="#switching-to-postgresql-database-server" title="Link to this heading">¶</a></h3>
<p>The most important recommendation is to switch to an actual database server.  By default, Galaxy will use <a class="reference external" href="https://www.sqlite.org/">SQLite</a>, which is a serverless simple file database engine.  Since it’s serverless, all of the database processing occurs in the Galaxy process itself.  This has two downsides: it occupies the aforementioned GIL (meaning that the process is not free to do other tasks), and it is not nearly as efficient as a dedicated database server.  There are other drawbacks, too.  When load increases with multiple users, the risk of transactional locks also increases.  Locks will cause (among other things) timeouts and job errors.  If you start with SQLite and then later realize a need for a database server, you’ll need to migrate your database or start over.  Galaxy does not provide an internal method to migrate data from SQLite, and although free conversion tools are available on the web, this process is non-trivial.</p>
<p>For this reason, Galaxy also supports PostgreSQL through our DB abstraction layer, <a class="reference external" href="https://www.sqlalchemy.org/">SQLAlchemy</a>.</p>
<p>To use an external database, you’ll need to set one up. That process is outside the scope of this document, but is usually simple. For example, on Debian and Redhat-based Linux distributions, one may already be installed. If not, it should be an <code class="docutils literal notranslate"><span class="pre">apt-get</span> <span class="pre">install</span></code> or <code class="docutils literal notranslate"><span class="pre">yum</span> <span class="pre">install</span></code> away. On macOS, there are installers available from the <a class="reference external" href="https://www.postgresql.org/">PostgreSQL</a> website.</p>
<p>Once installed, create a new database user and new database which the new user is the owner of.  No further setup is required, since Galaxy manages its own schema.  If you are using a UNIX socket to connect the application to the database (this is the standard case if Galaxy and the database are on the same system), you’ll want to name the database user the same as the system user under which you run the Galaxy process.</p>
<p>To configure Galaxy, set <code class="docutils literal notranslate"><span class="pre">database_connection</span></code> in Galaxy’s config file, <code class="docutils literal notranslate"><span class="pre">config/galaxy.yml</span></code>. The syntax for a database URL is explained in the <a class="reference external" href="https://docs.sqlalchemy.org/en/latest/core/engines.html">SQLAlchemy documentation</a>.</p>
<p>An example database URL with username and password:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">postgresql</span><span class="p">:</span><span class="o">//</span><span class="n">username</span><span class="p">:</span><span class="n">password</span><span class="nd">@localhost</span><span class="o">/</span><span class="n">mydatabase</span>
</pre></div>
</div>
<p>It’s worth noting that some platforms (for example, Debian/Ubuntu) store database sockets in a directory other than the database engine’s default. If you’re connecting to a database server on the same host as the Galaxy server and the socket is in a non-standard location, you’ll need to use these custom arguments (this is the default for Debian/Ubuntu, change as necessary for your installation):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>postgresql:///mydatabase?host=/var/run/postgresql
</pre></div>
</div>
<p>For more hints on available options for the database URL, see the <a class="reference external" href="https://docs.sqlalchemy.org/en/latest/core/engines.html#database-urls">SQLAlchemy documentation</a>.</p>
<section id="mysql-database-server-unsupported">
<h4>MySQL database server (unsupported)<a class="headerlink" href="#mysql-database-server-unsupported" title="Link to this heading">¶</a></h4>
<p>Postgres database backend is far more used and better tested, please use it if you can.</p>
<p>In the past Galaxy supported <a class="reference external" href="https://dev.mysql.com/">MySQL</a>, but currently there may be nontrivial problems associated with it, so expect some amount of troubleshooting when using it.</p>
<p>Connection string example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mysql</span><span class="p">:</span><span class="o">//</span><span class="n">username</span><span class="p">:</span><span class="n">password</span><span class="nd">@localhost</span><span class="o">/</span><span class="n">mydatabase</span>
</pre></div>
</div>
<p>Connecting using socket on a Debian/Ubuntu system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>mysql:///mydatabase?unix_socket=/var/run/mysqld/mysqld.sock
</pre></div>
</div>
<p>Some tips when using MySQL:</p>
<ul class="simple">
<li><p>If you encounter the “MySQL server has gone away” error, please note the <code class="docutils literal notranslate"><span class="pre">database_engine_option_pool_recycle</span></code> option in <code class="docutils literal notranslate"><span class="pre">config/galaxy.yml</span></code>. If this does not solve your problem, see <a class="reference external" href="https://lists.galaxyproject.org/archives/list/galaxy-dev&#64;lists.galaxyproject.org/message/FL2TMUL2HDMQYZEY2VKVIVATQF6GXZ5X/">this post</a> on the Galaxy Development <a class="reference external" href="https://galaxyproject.org/mailing-lists/">mailing list</a>.</p></li>
<li><p>Please make sure the database output is in UTF-8, otherwise you may encounter Python TypeErrors.</p></li>
<li><p>If you are using <a class="reference external" href="https://dev.mysql.com/">MySQL</a> with <a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html">MyISAM</a> table engine, when Galaxy is in multiprocess configuration, workflow steps will <a class="reference external" href="https://lists.galaxyproject.org/archives/list/galaxy-dev&#64;lists.galaxyproject.org/thread/4MV7YVL43NGNFOXGZ2MBESOPEIRHMAOD/#MK7ODDFJGZWS6W2F7NGOUY6AGT7DJDXT">get executed out of order</a> and fail. Use <a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html">InnoDB</a> engine instead or switch to <a class="reference external" href="https://www.postgresql.org/">PostgreSQL</a>.</p></li>
</ul>
</section>
</section>
<section id="using-a-proxy-server">
<h3>Using a proxy server<a class="headerlink" href="#using-a-proxy-server" title="Link to this heading">¶</a></h3>
<p>Galaxy contains a standalone web server and can serve all of its content directly to clients.  However, some tasks (such as serving static content) can be offloaded to a dedicated server that handles these tasks more efficiently.  A proxy server also allows you to authenticate users externally using any method supported by the proxy (for example, Kerberos or LDAP), instruct browsers to cache content, and compress outbound data. Also, Galaxy’s built-in web server does not support byte-range requests (required for many external display applications), but this functionality can be offloaded to a proxy server.  In addition to freeing the GIL, compression and caching will reduce page load times.</p>
<p>Downloading and uploading data can also be moved to the proxy server.  This is explained in the <a class="reference internal" href="#make-the-proxy-handle-uploads-and-downloads">Make the proxy handle uploads and downloads</a> section below.</p>
<p>Virtually any server that proxies HTTP should work, although we provide configuration examples for:</p>
<ul class="simple">
<li><p><a class="reference internal" href="apache.html"><span class="std std-doc">Apache</span></a>, and</p></li>
<li><p><a class="reference internal" href="nginx.html"><span class="std std-doc">nginx</span></a>, a high performance reverse proxy, used by our public Galaxy sites</p></li>
</ul>
</section>
<section id="using-a-compute-cluster">
<h3>Using a compute cluster<a class="headerlink" href="#using-a-compute-cluster" title="Link to this heading">¶</a></h3>
<p>Galaxy is a framework that runs command-line tools, and if properly configured, can run these tools on a compute <a class="reference internal" href="cluster.html"><span class="std std-doc">cluster</span></a>.  Without a cluster, you’ll be limited to the number of cores in your server, minus those needed to run Galaxy itself.  Galaxy currently supports TORQUE PBS, PBS Pro, Platform LSF, and Sun Grid Engine clusters, and does not require a dedicated or special cluster configuration.  Tools can even run on heterogeneous cluster nodes (differing operating systems), as long as any dependencies necessary to run the tool are available on that platform.</p>
<p>Using a cluster will also net you a fringe benefit: When running tools locally, they are child processes of the Galaxy server.  This means that if you restart the server, you lose contact with those jobs, and they must be restarted.  However on the cluster, if the Galaxy server restarts, the jobs will continue to run and finish.  Once the Galaxy job manager starts up, it’ll resume tracking and finishing jobs as if nothing had happened.</p>
<p>Configuration is not difficult once your cluster is set up.  Details can be found on the <a class="reference internal" href="cluster.html"><span class="std std-doc">cluster</span></a> page.</p>
</section>
<section id="distributing-data">
<h3>Distributing Data<a class="headerlink" href="#distributing-data" title="Link to this heading">¶</a></h3>
<p>Information on distributing Galaxy datasets across multiple disk and leveraging services such as S3 can be found in the <a class="reference external" href="https://training.galaxyproject.org/training-material/topics/admin/tutorials/object-store/tutorial.html">Galaxy Training Materials</a> and in the <a class="reference external" href="https://github.com/galaxyproject/galaxy/blob/dev/lib/galaxy/config/sample/object_store_conf.xml.sample">sample object_store_conf.xml file</a>.</p>
</section>
<section id="cleaning-up-datasets">
<h3>Cleaning up datasets<a class="headerlink" href="#cleaning-up-datasets" title="Link to this heading">¶</a></h3>
<p>When datasets are deleted from a history or library, it is simply marked as deleted and not actually removed, since it can later be undeleted.  To free disk space, a set of scripts can be run (e.g. from <code class="docutils literal notranslate"><span class="pre">cron</span></code>) to remove the data files as specified by local policy.  See the <a class="reference external" href="https://galaxyproject.org/admin/config/performance/purge-histories-and-datasets/">Purge histories and datasets</a> page for instructions.</p>
</section>
<section id="rotate-log-files">
<h3>Rotate log files<a class="headerlink" href="#rotate-log-files" title="Link to this heading">¶</a></h3>
<p>To use logrotate to rotate Galaxy log files, add a new file named <code class="docutils literal notranslate"><span class="pre">galaxy</span></code> to <code class="docutils literal notranslate"><span class="pre">/etc/logrotate.d/</span></code> directory with something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PATH_TO_GALAXY_LOG_FILES</span> <span class="p">{</span>
  <span class="n">weekly</span>
  <span class="n">rotate</span> <span class="mi">8</span>
  <span class="n">copytruncate</span>
  <span class="n">compress</span>
  <span class="n">missingok</span>
  <span class="n">notifempty</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="local-data">
<h3>Local Data<a class="headerlink" href="#local-data" title="Link to this heading">¶</a></h3>
<p>To get started with setting up local data, please see <a class="reference external" href="https://galaxyproject.org/admin/data-integration/">Data Integration</a>.</p>
<ul class="simple">
<li><p>All local <em>reference genomes</em> must be included in the <code class="docutils literal notranslate"><span class="pre">builds.txt</span></code> file.</p></li>
<li><p>Some tools (for example, Extract Genomic DNA) require that you cache (potentially huge) local .2bit data.</p></li>
<li><p>Other tools (for example, Bowtie2) require that you cache both .fasta data and tool-specific indexes.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">galaxy_dist/tool-data/</span></code> directory contains a set of sample location (<code class="docutils literal notranslate"><span class="pre">&lt;data_label&gt;.loc</span></code>) files that describe the metadata and path to local data and indexes.</p></li>
<li><p>Installed tool packages from the <a class="reference external" href="https://galaxyproject.org/toolshed/">Tool Shed</a> may also include location files.</p></li>
<li><p>Comments in location files explain the expected format.</p></li>
<li><p><a class="reference external" href="https://galaxyproject.org/admin/data-integration/">Data Integration</a> explain how to obtain, create, or rysnc many common data and indexes. See an individual Tool Shed repository’s documentation for more details.</p></li>
</ul>
</section>
<section id="enable-upload-via-ftp">
<h3>Enable upload via FTP<a class="headerlink" href="#enable-upload-via-ftp" title="Link to this heading">¶</a></h3>
<p>File sizes have grown very large thanks to rapidly advancing sequencer technology, and it is not always practical to upload these files through the browser. Thankfully, a simple solution is to allow Galaxy users to upload them via FTP and import those files in to their histories. Configuration for FTP is explained on the <a class="reference internal" href="special_topics/ftp.html"><span class="std std-doc">File Upload via FTP</span></a> page.</p>
</section>
</section>
<section id="advanced-configuration">
<h2>Advanced configuration<a class="headerlink" href="#advanced-configuration" title="Link to this heading">¶</a></h2>
<section id="load-balancing-and-web-application-scaling">
<h3>Load balancing and web application scaling<a class="headerlink" href="#load-balancing-and-web-application-scaling" title="Link to this heading">¶</a></h3>
<p>As already mentioned, unloading work from the Galaxy process is important due to the Python <a class="reference external" href="https://docs.python.org/c-api/init.html#thread-state-and-the-global-interpreter-lock">Global Interpreter Lock</a> (GIL). The GIL is how Python ensures thread safety, and it accomplishes this by only allowing one thread to control execution at a time. This means that regardless of the number of cores in your server, Galaxy can only use one. However, there’s a solution: run multiple Galaxy processes and use the proxy server to balance across all of these processes. In practice, Galaxy is split into job handler and web server processes. Job handlers do not service any user requests directly via the web. Instead, they watch the database for new jobs, and upon finding them, handle the preparation, monitoring, running, and completion of them. Likewise, the web server processes are free to deal only with serving content and files to web clients.</p>
<p>Full details on how to configure scaling and load balancing can be found in the <a class="reference internal" href="scaling.html"><span class="std std-doc">scaling</span></a> documentation.</p>
</section>
<section id="unloading-even-more-work">
<h3>Unloading even more work<a class="headerlink" href="#unloading-even-more-work" title="Link to this heading">¶</a></h3>
<p>For those readers who’ve already been running Galaxy on a cluster, a bit of information was recently added to the <a class="reference internal" href="cluster.html"><span class="std std-doc">cluster</span></a> documentation regarding running the data source tools on the cluster (contrary to the default configuration).  Running all tools on the cluster is strongly encouraged, so if you have not done this, please check out the new information.</p>
</section>
<section id="tune-the-database">
<h3>Tune the database<a class="headerlink" href="#tune-the-database" title="Link to this heading">¶</a></h3>
<p><a class="reference external" href="https://www.postgresql.org/">PostgreSQL</a> can store results more efficiently than Galaxy, and as a result, reduce Galaxy’s memory footprint. When a query is made, the result will remain on the Postgres server and Galaxy can retrieve only the rows it needs. To enable this, set <code class="docutils literal notranslate"><span class="pre">database_engine_option_server_side_cursors:</span> <span class="pre">true</span></code> in the Galaxy config.</p>
<p>If your server logs errors about the database connection pool size, you may need to increase the default minimum and maximum number of pool connections, 5 and 10.  These config file options are <code class="docutils literal notranslate"><span class="pre">database_engine_option_pool_size</span></code> and <code class="docutils literal notranslate"><span class="pre">database_engine_option_max_overflow</span></code>.</p>
<p>Finally, if you are using Galaxy &lt;= release_2014.06.02, we recommend that you instruct Galaxy to use one database connection per thread, to avoid connection overhead and overuse.  This can be enabled with <code class="docutils literal notranslate"><span class="pre">database_engine_option_strategy:</span> <span class="pre">threadlocal</span></code>.</p>
</section>
<section id="make-the-proxy-handle-uploads-and-downloads">
<h3>Make the proxy handle uploads and downloads<a class="headerlink" href="#make-the-proxy-handle-uploads-and-downloads" title="Link to this heading">¶</a></h3>
<p>By default, Galaxy receives file uploads as a stream from the proxy server and then writes this file to disk.  Likewise, it sends files as a stream to the proxy server.  This occupies the GIL in that Galaxy process and will decrease responsiveness for other operations in that process.  To solve this problem, you can configure your proxy server to serve downloads directly, involving Galaxy only for the task of authorizing that the user has permission to read the dataset.  If using nginx as the proxy, you can configure it to receive uploaded files and write them to disk itself, only notifying Galaxy of the upload once it’s completed.  All the details on how to configure these can be found on the <a class="reference internal" href="apache.html"><span class="std std-doc">Apache</span></a> and <a class="reference internal" href="nginx.html"><span class="std std-doc">nginx</span></a> proxy instruction pages.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="config_logging.html" class="btn btn-neutral float-left" title="Logging Configuration" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="security.html" class="btn btn-neutral float-right" title="Security considerations" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Galaxy Committers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>